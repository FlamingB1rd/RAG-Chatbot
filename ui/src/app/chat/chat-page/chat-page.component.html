<!-- NAVBAR -->
<mat-toolbar class="toolbar">
  <mat-icon class="logo-icon">smart_toy</mat-icon>
  <span class="title">TU-Sofia RAG Chatbot</span>

  <span class="spacer"></span>

  <!-- right side buttons -->
  <button mat-button color="primary" routerLink="/admin">
    <mat-icon>admin_panel_settings</mat-icon>
    <span>Admin</span>
  </button>

  <button mat-button color="primary" routerLink="/qa">
    <mat-icon>quiz</mat-icon>
    <span>Q / A</span>
  </button>
</mat-toolbar>

<div class="chat-window">
  @if (messages.length === 0) {
    <div class="empty">Няма съобщения още…</div>
  } @else {
    @for (m of messages; track m.id) {
      <div class="row" [class.row-me]="m.role==='user'">
        <div class="avatar" [class.me]="m.role==='user'">
          @if (m.role==='assistant') {
            <mat-icon>smart_toy</mat-icon>
          } @else {
            <mat-icon>person</mat-icon>
          }
        </div>

        <div class="msg">
          <div class="meta">
            <span class="who" [class.me]="m.role==='user'">
              {{ m.role === 'user' ? 'Потребител' : 'Асистент' }}
            </span>
            <span class="time">{{ m.timeStamp | date:'shortTime' }}</span>
          </div>

          <div class="bubble" [class.me]="m.role==='user'">
            @if (m.role === 'assistant') {
              <markdown [data]="m.text"></markdown>
            } @else {
              {{ m.text }}
            }
          </div>
        </div>
      </div>
    }
  }
  <div #bottom></div>
</div>

<!-- typing indicator -->
<div class="chat-status" *ngIf="loading">
  AI chatbot is responding…
</div>

<!-- composer -->
<div class="composer">
  <mat-form-field class="input" appearance="outline">
    <mat-label>Напиши въпрос…</mat-label>
    <textarea matInput rows="2"
              [(ngModel)]="input"
              (keydown)="onEnter($event)"
              [disabled]="loading"></textarea>
  </mat-form-field>

  <button mat-flat-button color="primary" class="send"
          (click)="onSend()" [disabled]="loading || !input.trim()">
    <mat-icon>send</mat-icon>
    Изпрати
  </button>
</div>

<!-- floating spinner (can keep it) -->
<div class="loading" *ngIf="loading">
  <mat-progress-spinner mode="indeterminate" diameter="36"></mat-progress-spinner>
</div>
